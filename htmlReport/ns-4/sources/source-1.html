


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=windows-1256"> 
  <title>Coverage Report > insertData</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">software_project.DataBase.insert</a>
</div>

<h1>Coverage Summary for Class: insertData (software_project.DataBase.insert)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">insertData</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    63.6%
  </span>
  <span class="absValue">
    (7/11)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    45.3%
  </span>
  <span class="absValue">
    (67/148)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package software_project.DataBase.insert;
&nbsp;
&nbsp;import software_project.DataBase.DB_Connection;
&nbsp;import software_project.DataBase.retrieve.retrieve;
&nbsp;import software_project.EventManagement.Event;
&nbsp;import software_project.EventManagement.EventService;
&nbsp;import software_project.EventManagement.Places;
&nbsp;import software_project.UserManagement.User;
&nbsp;import software_project.Vendor.VendorReview;
&nbsp;import software_project.Vendor.VendorService;
&nbsp;import software_project.helper.Generator;
&nbsp;
&nbsp;import java.sql.*;
&nbsp;import java.util.Arrays;
&nbsp;import java.util.List;
&nbsp;
&nbsp;public class insertData {
&nbsp;    private String status;
&nbsp;    private Connection conn;
&nbsp;
&nbsp;    retrieve retrive;
&nbsp;
<b class="fc">&nbsp;    public insertData(Connection conn) {</b>
<b class="fc">&nbsp;        this.conn = conn;</b>
<b class="fc">&nbsp;        retrive = new retrieve(conn);</b>
&nbsp;    }
&nbsp;
&nbsp;    public String getStatus() {
<b class="nc">&nbsp;        return status;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setStatus(String status) {
<b class="fc">&nbsp;        this.status = status;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean insertUser(User user) {
&nbsp;
&nbsp;        try {
<b class="nc">&nbsp;            conn.setAutoCommit(false);</b>
<b class="nc">&nbsp;            String query = &quot;insert into \&quot;users\&quot; (\&quot;First_Name\&quot;, \&quot;Last_Name\&quot;, \&quot;User_Name\&quot;, \&quot;Email\&quot;, \&quot;Password\&quot;, \&quot;Phone\&quot;, \&quot;User_Type\&quot; , \&quot;image\&quot;) values (?, ?, ?, ?, ?, ?, ?, ?);&quot;;</b>
<b class="nc">&nbsp;            PreparedStatement preparedStmt = conn.prepareStatement(query);</b>
<b class="nc">&nbsp;            preparedStmt = Generator.userToPS(preparedStmt, user);</b>
<b class="nc">&nbsp;            preparedStmt.execute();</b>
<b class="nc">&nbsp;            setStatus(&quot;User was inserted successfully&quot;);</b>
<b class="nc">&nbsp;            conn.commit();</b>
<b class="nc">&nbsp;            return true;</b>
<b class="nc">&nbsp;        } catch (Exception e) {</b>
<b class="nc">&nbsp;            e.printStackTrace();</b>
<b class="nc">&nbsp;            setStatus(&quot;Couldn&#39;t insert user&quot;);</b>
&nbsp;
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    public boolean insertEventService(EventService es) {
&nbsp;
&nbsp;        try {
<b class="fc">&nbsp;            conn.setAutoCommit(false);</b>
<b class="fc">&nbsp;            String query = &quot;insert into \&quot;Event_Service\&quot; (\&quot;Title\&quot;, \&quot;Details\&quot;, \&quot;Event_Category\&quot;, \&quot;Price\&quot;, \&quot;Place\&quot;, \&quot;Start_Time\&quot;, \&quot;End_Time\&quot; , \&quot;Booking_Time\&quot;) values (?, ?, ?, ?, ?, ?, ?, ?);&quot;;</b>
<b class="fc">&nbsp;            PreparedStatement preparedStmt = conn.prepareStatement(query);</b>
<b class="fc">&nbsp;            preparedStmt = Generator.eventStatementToPS(preparedStmt, es);</b>
<b class="fc">&nbsp;            preparedStmt.execute();</b>
<b class="fc">&nbsp;            setStatus(&quot;Event added successfully&quot;);</b>
<b class="fc">&nbsp;            conn.commit();</b>
<b class="fc">&nbsp;            return true;</b>
<b class="nc">&nbsp;        } catch (Exception e) {</b>
&nbsp;
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    public boolean insertEventService_Place(EventService es) {
&nbsp;        try {
<b class="fc">&nbsp;            conn.setAutoCommit(false);</b>
<b class="fc">&nbsp;            String query = &quot;insert into \&quot;Place_EventServices\&quot; values (?, ?);&quot;;</b>
<b class="fc">&nbsp;            PreparedStatement preparedStmt = conn.prepareStatement(query);</b>
<b class="fc">&nbsp;            preparedStmt.setInt(1,retrive.retriveplace(es.getPlace()).getId());</b>
<b class="fc">&nbsp;            preparedStmt.setInt(2,retrive.retriveeventid(es.getTitle()));</b>
&nbsp;
<b class="fc">&nbsp;            preparedStmt.execute();</b>
<b class="fc">&nbsp;            setStatus(&quot;Event_Place added successfully&quot;);</b>
<b class="fc">&nbsp;            conn.commit();</b>
<b class="fc">&nbsp;            return true;</b>
<b class="nc">&nbsp;        } catch (Exception e) {</b>
&nbsp;
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    public boolean insertVenue(Places p) {
&nbsp;
&nbsp;        try {
<b class="fc">&nbsp;            conn.setAutoCommit(false);</b>
<b class="fc">&nbsp;            String query = &quot;insert into \&quot;Places\&quot; (\&quot;Name\&quot;, \&quot;Capacity\&quot;, \&quot;Amenities\&quot;) values (?, ?, ? );&quot;;</b>
<b class="fc">&nbsp;            PreparedStatement preparedStmt = conn.prepareStatement(query);</b>
<b class="fc">&nbsp;            preparedStmt = Generator.venueStatementToPS(preparedStmt, p);</b>
<b class="fc">&nbsp;            preparedStmt.execute();</b>
<b class="fc">&nbsp;            setStatus(&quot;Venue added successfully&quot;);</b>
<b class="fc">&nbsp;            conn.commit();</b>
<b class="fc">&nbsp;            return true;</b>
<b class="nc">&nbsp;        } catch (Exception e) {</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    public void insertNotAvailableVendor(Event ee)
&nbsp;    {
&nbsp;        try {
<b class="nc">&nbsp;            conn.setAutoCommit(false);</b>
<b class="nc">&nbsp;            String query = &quot;insert into \&quot;Vendor_NotAvailable\&quot; (\&quot;Vendor_UN\&quot;,\&quot;Date\&quot; , \&quot;Time\&quot;) values (?,?,?);&quot;;</b>
<b class="nc">&nbsp;            for(String s: ee.getVendors()) {</b>
<b class="nc">&nbsp;                PreparedStatement preparedStmt2 = conn.prepareStatement(query);</b>
<b class="nc">&nbsp;                preparedStmt2.setString(1,s);</b>
<b class="nc">&nbsp;                preparedStmt2.setString(2,ee.getDate());</b>
<b class="nc">&nbsp;                preparedStmt2.setString(3,ee.getTime());</b>
<b class="nc">&nbsp;                preparedStmt2.execute();</b>
<b class="nc">&nbsp;                conn.commit();</b>
<b class="nc">&nbsp;                conn.setAutoCommit(false);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;
&nbsp;
&nbsp;
&nbsp;
<b class="nc">&nbsp;        }catch (Exception e){</b>
&nbsp;
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean insertEvent(Event e) {
&nbsp;        try {
<b class="nc">&nbsp;            conn.setAutoCommit(false);</b>
<b class="nc">&nbsp;            String query = &quot;insert into \&quot;Event\&quot; (\&quot;EventService_id\&quot;,\&quot;Date\&quot;, \&quot;Time\&quot;, \&quot;Description\&quot;, \&quot;Attendee_Count\&quot;,\&quot;Balance\&quot;) values (?,?, ?, ?, ?,?);&quot;;//id is serial</b>
<b class="nc">&nbsp;            String query2 = &quot;insert into \&quot;Guests\&quot; (\&quot;Event_id\&quot;,\&quot;Guest_Name\&quot;) values (?,?);&quot;;//guest id is serial</b>
<b class="nc">&nbsp;            String query3 = &quot;insert into \&quot;images\&quot; (\&quot;Event_id\&quot;,\&quot;Image_Path\&quot;) values (?,?);&quot;;//image id is serial</b>
<b class="nc">&nbsp;            String query4 = &quot;insert into \&quot;Vendor_Bookings\&quot;(\&quot;Vendor_UN\&quot;,\&quot;Event_id\&quot;) values (?,?);&quot;;//booking id is serial</b>
<b class="nc">&nbsp;            String query5 = &quot;insert into \&quot;Event_User\&quot;(\&quot;UserName\&quot;,\&quot;Event Id\&quot;) values (?,?);&quot;;</b>
&nbsp;
<b class="nc">&nbsp;            PreparedStatement preparedStmt = conn.prepareStatement(query);</b>
<b class="nc">&nbsp;            preparedStmt = Generator.eventBookingStatementToPS(preparedStmt, e);</b>
<b class="nc">&nbsp;            preparedStmt.execute();</b>
<b class="nc">&nbsp;            conn.commit();</b>
<b class="nc">&nbsp;            conn.setAutoCommit(false);</b>
&nbsp;
<b class="nc">&nbsp;            int id = retrieve.retriveeventIID(conn);</b>
&nbsp;
<b class="nc">&nbsp;            for(String s: e.getVendors()) {</b>
<b class="nc">&nbsp;                PreparedStatement preparedStmt2 = conn.prepareStatement(query4);</b>
<b class="nc">&nbsp;                preparedStmt2 = Generator.vendorsStatementToPS(preparedStmt2, s , id);</b>
<b class="nc">&nbsp;                preparedStmt2.execute();</b>
<b class="nc">&nbsp;                conn.commit();</b>
<b class="nc">&nbsp;                conn.setAutoCommit(false);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;
<b class="nc">&nbsp;            for(String s: e.getGuestList()) {</b>
<b class="nc">&nbsp;                PreparedStatement preparedStmt2 = conn.prepareStatement(query2);</b>
<b class="nc">&nbsp;                preparedStmt2 = Generator.guestListStatementToPS(preparedStmt2, s , id);</b>
<b class="nc">&nbsp;                preparedStmt2.execute();</b>
<b class="nc">&nbsp;                conn.commit();</b>
<b class="nc">&nbsp;                conn.setAutoCommit(false);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;
<b class="nc">&nbsp;            for(String path: e.getImages()) {</b>
<b class="nc">&nbsp;                PreparedStatement preparedStmt2 = conn.prepareStatement(query3);</b>
<b class="nc">&nbsp;                preparedStmt2 = Generator.imageStatementToPS(preparedStmt2,  path , id);</b>
<b class="nc">&nbsp;                preparedStmt2.execute();</b>
<b class="nc">&nbsp;                conn.commit();</b>
<b class="nc">&nbsp;                conn.setAutoCommit(false);</b>
&nbsp;
<b class="nc">&nbsp;            }</b>
&nbsp;
<b class="nc">&nbsp;            PreparedStatement preparedStmt5 = conn.prepareStatement(query5);</b>
<b class="nc">&nbsp;            preparedStmt5.setString(1,e.getUsername());</b>
<b class="nc">&nbsp;            preparedStmt5.setInt(2,id);</b>
<b class="nc">&nbsp;            preparedStmt5.execute();</b>
<b class="nc">&nbsp;            conn.commit();</b>
<b class="nc">&nbsp;            conn.setAutoCommit(false);</b>
&nbsp;
&nbsp;
&nbsp;
<b class="nc">&nbsp;            setStatus(&quot;Event booked successfully&quot;);</b>
<b class="nc">&nbsp;            conn.commit();</b>
<b class="nc">&nbsp;            return true;</b>
<b class="nc">&nbsp;        } catch (Exception exception) {</b>
&nbsp;
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    public boolean insertVendorService(VendorService vs) {
&nbsp;        try {
<b class="fc">&nbsp;            conn.setAutoCommit(false);//                                       avgRating</b>
<b class="fc">&nbsp;            String query = &quot;insert into \&quot;Vendor_Service\&quot; (\&quot;Vendor_User_Name\&quot;,\&quot;Type\&quot;,\&quot;Description\&quot;,\&quot;Price\&quot;,\&quot;Availability\&quot;,\&quot;Average_Rating\&quot;) values (?, CAST(? AS \&quot;Vendor_Type\&quot;), ?, ?, ?, ?);&quot;;//service id is serial</b>
<b class="fc">&nbsp;            PreparedStatement preparedStmt = conn.prepareStatement(query);</b>
<b class="fc">&nbsp;            preparedStmt.setString(1,vs.getVendorUserName());</b>
<b class="fc">&nbsp;            preparedStmt.setString(2,vs.getServiceType());</b>
<b class="fc">&nbsp;            preparedStmt.setString(3,vs.getServiceDescription());</b>
<b class="fc">&nbsp;            preparedStmt.setString(4,vs.getServicePrice());</b>
<b class="fc">&nbsp;            preparedStmt.setString(5,vs.getServiceAvailability());</b>
<b class="fc">&nbsp;            preparedStmt.setInt(6,vs.getAverageRating());</b>
&nbsp;
<b class="fc">&nbsp;            preparedStmt.execute();</b>
<b class="fc">&nbsp;            setStatus(&quot;service confirmed to vendor successfully&quot;);</b>
<b class="fc">&nbsp;            conn.commit();</b>
<b class="fc">&nbsp;            return true;</b>
<b class="nc">&nbsp;        } catch (Exception e) {</b>
&nbsp;
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public boolean insertVendorReview(VendorReview vr) {
<b class="fc">&nbsp;        Statement stmt = null;</b>
&nbsp;        try {
<b class="fc">&nbsp;            stmt = conn.createStatement();</b>
<b class="fc">&nbsp;            conn.setAutoCommit(false);</b>
<b class="fc">&nbsp;            String query = &quot;insert into \&quot;Vendor_Review\&quot; (\&quot;Vendor_User_Name\&quot;,\&quot;Customer_User_Name\&quot;,\&quot;Rating\&quot;,\&quot;FeedBack_Text\&quot;) values (?, ?, ?, ?);&quot;;//review id is serial</b>
<b class="fc">&nbsp;            PreparedStatement preparedStmt = conn.prepareStatement(query);</b>
<b class="fc">&nbsp;            preparedStmt.setString(1,vr.getVendorUserName());</b>
<b class="fc">&nbsp;            preparedStmt.setString(2,vr.getCustomerUserName());</b>
<b class="fc">&nbsp;            preparedStmt.setString(3,vr.getRating());</b>
<b class="fc">&nbsp;            preparedStmt.setString(4,vr.getFeedBackText());</b>
&nbsp;
<b class="fc">&nbsp;            preparedStmt.execute();</b>
&nbsp;
<b class="fc">&nbsp;            conn.commit();</b>
<b class="fc">&nbsp;            conn.setAutoCommit(false);</b>
&nbsp;            //return all reviews for this vendor then calculate the avg and update the avgReview in Vendor_Service table
&nbsp;
<b class="fc">&nbsp;            String query2 = &quot;select \&quot;Rating\&quot; from \&quot;Vendor_Review\&quot; where \&quot;Vendor_User_Name\&quot; = \&#39;&quot; + vr.getVendorUserName() + &quot;\&#39; ;&quot;;</b>
&nbsp;
<b class="fc">&nbsp;            ResultSet rs = stmt.executeQuery(query2);</b>
<b class="fc">&nbsp;            int avgRating = 0;</b>
<b class="fc">&nbsp;            int ratingsCount = 0;</b>
<b class="fc">&nbsp;            while (rs.next()) {</b>
<b class="fc">&nbsp;                avgRating += Generator.StarCounter(rs.getString(&quot;Rating&quot;));</b>
<b class="fc">&nbsp;                ratingsCount++;</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            avgRating /= ratingsCount;</b>
&nbsp;
<b class="fc">&nbsp;            String query3 = &quot;update \&quot;Vendor_Service\&quot; set \&quot;Average_Rating\&quot; = \&#39;&quot; + avgRating + &quot;\&#39; where \&quot;Vendor_User_Name\&quot; = \&#39;&quot; + vr.getVendorUserName() + &quot;\&#39;;&quot;;</b>
<b class="fc">&nbsp;            stmt.executeUpdate(query3);</b>
&nbsp;
&nbsp;
&nbsp;
&nbsp;
<b class="fc">&nbsp;            setStatus(&quot;service confirmed to vendor successfully&quot;);</b>
<b class="fc">&nbsp;            conn.commit();</b>
&nbsp;
<b class="fc">&nbsp;            return true;</b>
<b class="nc">&nbsp;        } catch (Exception e) {</b>
<b class="nc">&nbsp;            e.printStackTrace();</b>
&nbsp;
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;}
&nbsp;
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-03-25 21:40</div>
</div>
</body>
</html>
